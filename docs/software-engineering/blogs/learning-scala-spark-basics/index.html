<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Learning Scala Spark basics | Sakthi Priyan H</title>
    <meta name="description" content="Systems that Scale. Wealth that Compounds."><link rel="stylesheet" href="https://sakthipriyan.com/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/default.min.css">
</head>
<body class="software-engineering"><header class="site-header">
    <nav class="main-nav">
        
            
            
            
            
            
            <div class="logo">
                <a href="https://sakthipriyan.com/" class="name-link">Sakthi Priyan H</a>
                <span class="separator"> | </span>
                
                <a href="/software-engineering/" class="name-link">Software Engineering</a>
            </div>
            
            
            <button class="hamburger" aria-label="Toggle navigation" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <ul class="nav-links">
                
                
                
                
                
                    
                    
                    
                        
                            
                            
                                <li><a href="https://sakthipriyan.com/software-engineering/blogs/">Blogs</a></li>
                            
                        
                    
                
                    
                    
                    
                        
                            
                            
                        
                    
                
                    
                    
                    
                        
                            
                            
                                <li><a href="https://sakthipriyan.com/software-engineering/slides/">Slides</a></li>
                            
                        
                    
                
                    
                    
                    
                        
                            
                            
                            
                                
                                    
                                
                            
                            
                                <li><a href="https://sakthipriyan.com/software-engineering/tags/">Tags</a></li>
                            
                        
                    
                
                    
                    
                    
                        
                            
                            
                        
                    
                
                    
                    
                    
                        
                            
                            
                        
                    
                
            </ul>
        
    </nav>
</header>
<nav class="breadcrumb" aria-label="breadcrumb">
    <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
            <a href="https://sakthipriyan.com/">Home</a>
        </li>
            
            
                
                
                
                
                
                
                
                
                <li class="breadcrumb-item">
                    
                        <a href="/software-engineering/">Software Engineering</a>
                    
                </li>
                
                
                
                
                
                    
                    
                        
                        
                        <li class="breadcrumb-item">
                            
                                <a href="/software-engineering/blogs/">Blogs</a>
                            
                        </li>
                        
                    
                
            
            
            
            
            <li class="breadcrumb-item active" aria-current="page">
                <span>Learning Scala Spark basics</span>
            </li>
            
        </ol>
</nav>

    <main>
<article class="blog-post">
    
<header class="content-header">
    <h1 class="content-title">Learning Scala Spark basics</h1>
    <p class="content-summary">using spark shell in local</p>

    <div class="content-meta">
        <span class="meta-item">
            <span class="meta-icon">üìÖ</span>
            <time datetime=" 2018-11-24">Nov 24, 2018</time>
        </span>
        
        <span class="meta-item">
            <span class="meta-icon">üìñ</span>
            <span class="read-time">5 min read</span>
        </span>
    </div>

    <hr class="content-divider">
</header>

    <div class="post-content">
        <h3 id="apache-spark">Apache Spark</h3>
<p><a href="https://spark.apache.org/">Apache Spark‚Ñ¢</a> is a unified analytics engine for large-scale data processing. It can be used for variety of things like, big data processing, machine learning, stream processing and etc.,</p>
<h3 id="environment">Environment</h3>
<p>I had tested it in Mac OS and Ubuntu. May or may not work on Windows.</p>
<h4 id="prerequisites">Prerequisites</h4>
<p>Java 8 installed and available as <code>java</code> in command line.</p>
<h3 id="set-up">Set up</h3>
<h4 id="download">Download</h4>
<ol>
<li><a href="https://archive.apache.org/dist/spark/spark-2.2.0/spark-2.2.0-bin-hadoop2.7.tgz">Download</a> the Spark package from Apache Spark <a href="https://spark.apache.org/downloads.html">Website</a>. Download links points to Spark 2.2.0 which i had used. You can choose latest from the website.</li>
<li><a href="http://files.grouplens.org/datasets/movielens/ml-latest-small.zip">Download</a> movies data set from <a href="https://grouplens.org/datasets/movielens/">GroupLens</a>. Download links point to small dataset. You can choose larger one if you have infra.</li>
</ol>
<h4 id="unpack">Unpack</h4>
<p>Move both files to same directory.</p>
<pre><code>unzip ml-lastest-small.zip  
tar -xvzf spark-2.2.0-bin-hadoop2.7.tgz
</code></pre>
<h4 id="spark-shell">Spark Shell</h4>
<p>Move into the spark extracted directory.</p>
<pre><code>cd spark-2.2.0-bin-hadoop2.7
./bin/spark-shell
</code></pre>
<p>It will take some seconds to boot up, be patient.
Once it is up, you will be able to see,</p>
<pre><code>Spark context Web UI available at http://172.16.3.139:4040
Spark context available as 'sc' (master = local[*], app id = local-1543057723300).
Spark session available as 'spark'.
Welcome to	
  ____              __	
 / __/__  ___ _____/ /__
 _\ \/ _ \/ _ `/ __/  '_/
/___/ .__/\_,_/_/ /_/\_\   version 2.2.0
   /_/
  
Using Scala version 2.11.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_161)
Type in expressions to have them evaluated.
Type :help for more information.
scala&gt; 
</code></pre>
<p>You can see the <code>scala&gt;</code> prompt. We will be entering commands in this prompt.</p>
<h3 id="define-data-loading-function">Define data loading function</h3>
<pre><code>def loadDF(filepath:String) : org.apache.spark.sql.DataFrame 
= spark.read.format(&quot;com.databricks.spark.csv&quot;).option(&quot;header&quot;, &quot;true&quot;).option(&quot;inferSchema&quot;, &quot;true&quot;).load(filepath)
</code></pre>
<p>You will see following console output</p>
<pre><code>loadDF: (filepath: String)org.apache.spark.sql.DataFrame
</code></pre>
<h3 id="load-data-into-dataframe">Load Data into Dataframe</h3>
<p>Dataframe is similar to table in SQL world.</p>
<pre><code>val moviesFile = &quot;../ml-latest-small/movies.csv&quot;
val ratingsFile = &quot;../ml-latest-small/ratings.csv&quot;
val tagsFile = &quot;../ml-latest-small/tags.csv&quot;

val moviesDF = loadDF(moviesFile)

// You can load other files into dataframe as well.
</code></pre>
<h3 id="lets-start-the-journey">Let&rsquo;s start the journey</h3>
<p>Now we have <code>moviesDF</code> which loaded the data from <code>movies.csv</code> which we had downloaded earlier.</p>
<p>Refer <a href="https://spark.apache.org/docs/2.2.0/api/scala/index.html#org.apache.spark.sql.Dataset">this</a> documentation for various functions available in the dataframe.</p>
<h4 id="number-of-records">Number of records</h4>
<p>So simple, just call method <code>count</code>. As with Scala, single parentheses is optional for methods.</p>
<pre><code>moviesDF.count
</code></pre>
<p>It will show the number of records as follows</p>
<pre><code>res1: Long = 9742
</code></pre>
<h4 id="schema-of-the-dataframe">Schema of the Dataframe</h4>
<pre><code>moviesDF.printSchema
</code></pre>
<p>Output will show field names and data types.</p>
<pre><code>root
|-- movieId: integer (nullable = true)
|-- title: string (nullable = true)
|-- genres: string (nullable = true)
</code></pre>
<p>Dataframes can support complex data types such as map, array and struct. So, it can be nested as well.</p>
<h4 id="show-records-from-the-data-frame">Show records from the data frame</h4>
<pre><code>moviesDF.show
</code></pre>
<p>By default, it shows top 20 records in the dataframe.</p>
<pre><code>+-------+--------------------+--------------------+
|movieId|               title|              genres|
+-------+--------------------+--------------------+
|      1|    Toy Story (1995)|Adventure|Animati...|
|      2|      Jumanji (1995)|Adventure|Childre...|
|      3|Grumpier Old Men ...|      Comedy|Romance|
|      4|Waiting to Exhale...|Comedy|Drama|Romance|
|      5|Father of the Bri...|              Comedy|
|      6|         Heat (1995)|Action|Crime|Thri...|
|      7|      Sabrina (1995)|      Comedy|Romance|
|      8| Tom and Huck (1995)|  Adventure|Children|
|      9| Sudden Death (1995)|              Action|
|     10|    GoldenEye (1995)|Action|Adventure|...|
|     11|American Presiden...|Comedy|Drama|Romance|
|     12|Dracula: Dead and...|       Comedy|Horror|
|     13|        Balto (1995)|Adventure|Animati...|
|     14|        Nixon (1995)|               Drama|
|     15|Cutthroat Island ...|Action|Adventure|...|
|     16|       Casino (1995)|         Crime|Drama|
|     17|Sense and Sensibi...|       Drama|Romance|
|     18|   Four Rooms (1995)|              Comedy|
|     19|Ace Ventura: When...|              Comedy|
|     20|  Money Train (1995)|Action|Comedy|Cri...|
+-------+--------------------+--------------------+
only showing top 20 rows
</code></pre>
<p>Also, we can specify number of records as well.</p>
<pre><code>moviesDF.show(4)
</code></pre>
<h4 id="creating-new-dataframes">Creating new dataframes</h4>
<p>Operations such as <code>select</code> we do on dataframe creates another dataframe.</p>
<pre><code>val movieTitlesDF = moviesDF.select($&quot;title&quot;)
</code></pre>
<p>$&ldquo;title&rdquo; means <code>column</code> title. <code>select</code> also supports <code>&quot;title&quot;</code> as well. But, it cannot be mix of <code>column</code> and <code>string</code>.</p>
<p>Console output,</p>
<pre><code>movieTitlesDF: org.apache.spark.sql.DataFrame = [title: string]
</code></pre>
<p>Now we have created a new dataframe called 	<code>movieTitlesDF</code> from the <code>moviesDF</code></p>
<pre><code>movieTitlesDF.show(3)
+--------------------+
|               title|
+--------------------+
|    Toy Story (1995)|
|      Jumanji (1995)|
|Grumpier Old Men ...|
+--------------------+
only showing top 3 rows
</code></pre>
<h4 id="creating-new-fields">Creating new fields.</h4>
<p>In machine learning applications, for feature engineering, we would be deriving new fields.</p>
<p>Creating new new Dataframe with length of movie title.</p>
<pre><code>val titleDF = movieTitlesDF.select($&quot;title&quot;, length($&quot;title&quot;).alias(&quot;length&quot;))

titleDF.show(2)
+----------------+------+
|           title|length|
+----------------+------+
|Toy Story (1995)|    16|
|  Jumanji (1995)|    14|
+----------------+------+
only showing top 2 rows
</code></pre>
<h4 id="let-us-find-the-movie-name-with-the-longest-name">Let us find the movie name with the longest name,</h4>
<pre><code>titleDF.sort($&quot;length&quot;.desc).head

res2: org.apache.spark.sql.Row = [Dragon Ball Z the Movie: The World's Strongest (a.k.a. Dragon Ball Z: The Strongest Guy in The World) (Doragon b√¥ru Z: Kono yo de ichiban tsuyoi yatsu) (1990),158]
</code></pre>
<p>So the movie name is <code>Dragon Ball Z the Movie: The World's Strongest (a.k.a. Dragon Ball Z: The Strongest Guy in The World) (Doragon b√¥ru Z: Kono yo de ichiban tsuyoi yatsu) (1990)</code> which has <code>158</code> characters.</p>
<p>We have used <code>sort</code> and sorted the rows in dataframe using <code>length</code> in <code>desc</code> order.</p>
<h4 id="lets-do-pattern-matching">Let&rsquo;s do pattern matching.</h4>
<p>Find movies which has <code>(year)</code> in the name.</p>
<pre><code>titleDF.where($&quot;title&quot;.rlike(&quot;[0-9]{4}&quot;)).count
res3: Long = 9730
</code></pre>
<p>So, in total we have 12 movies without year in it.</p>
<h4 id="lets-work-with-array">Let&rsquo;s work with Array</h4>
<p>If you have seen the <code>moviesDF.show</code> closely, <code>genres</code> is <code>|</code> separated multiple values.</p>
<p>First we will split the <code>genres</code> column by <code>|</code> and make it as <code>array&lt;string&gt;</code></p>
<pre><code>val genresDF = moviesDF.select(split($&quot;genres&quot;,&quot;\\|&quot;).alias(&quot;genres&quot;))
genresDF: org.apache.spark.sql.DataFrame = [genres: array&lt;string&gt;]

genresDF.show(2)
+--------------------+
|              genres|
+--------------------+
|[Adventure, Anima...|
|[Adventure, Child...|
+--------------------+
only showing top 2 rows
</code></pre>
<p>As you can see, genres is an array now.</p>
<h4 id="find-out-top-3-genres-in-our-records">Find out top 3 genres in our records</h4>
<p>Next, we will explode the array and find the count of each genre.</p>
<pre><code>genresDF.select(explode($&quot;genres&quot;).alias(&quot;genre&quot;)).groupBy($&quot;genre&quot;).count().show(3)

+--------+-----+
|   genre|count|
+--------+-----+
|   Crime| 1199|
| Romance| 1596|
|Thriller| 1894|
+--------+-----+
only showing top 3 rows
</code></pre>
<h4 id="lets-find-top-3-movies-with-most-tags">Let&rsquo;s find top 3 movies with most tags</h4>
<pre><code>val tagsDF = loadDF(tagsFile)
tagsDF.groupBy($&quot;movieId&quot;).count.sort($&quot;count&quot;.desc).limit(3).
join(moviesDF, &quot;movieId&quot;).select(&quot;title&quot;,&quot;count&quot;).show()
+--------------------+-----+
|               title|count|
+--------------------+-----+
| Pulp Fiction (1994)|  181|
|   Fight Club (1999)|   54|
|2001: A Space Ody...|   41|
+--------------------+-----+
</code></pre>
<h4 id="that-is-not-all">That is not all</h4>
<p>We have gone through some basic functions available in dataframes.</p>
<ul>
<li>count</li>
<li>printSchema</li>
<li>show</li>
<li>select</li>
<li>length</li>
<li>alias</li>
<li>desc</li>
<li>sort, desc</li>
<li>split</li>
<li>rlike</li>
<li>where</li>
<li>head</li>
<li>groupBy</li>
</ul>
<p>Spark dataframe supports more number of operations and functions.</p>
<h3 id="enjoy-learning-spark">Enjoy learning Spark</h3>
<p>Expore more and play with the dataframe. You can use <code>ratings.csv</code> as well.</p>
<h3 id="references">References</h3>
<ol>
<li><a href="https://spark.apache.org/docs/2.2.0/sql-programming-guide.html">https://spark.apache.org/docs/2.2.0/sql-programming-guide.html</a></li>
<li><a href="https://spark.apache.org/docs/2.2.0/api/scala/index.html#org.apache.spark.sql.Dataset">https://spark.apache.org/docs/2.2.0/api/scala/index.html#org.apache.spark.sql.Dataset</a></li>
</ol>

    </div>

    
<footer class="content-footer">
    <hr class="content-divider">
    
    
    <div class="card-tags">
        <span class="tags-icon">üè∑Ô∏è</span>
        
        <a href="https://sakthipriyan.com/software-engineering/tags/spark/" class="tag-link">Spark</a>
        
        <a href="https://sakthipriyan.com/software-engineering/tags/scala/" class="tag-link">Scala</a>
        
        <a href="https://sakthipriyan.com/software-engineering/tags/shell/" class="tag-link">Shell</a>
        
        <a href="https://sakthipriyan.com/software-engineering/tags/learning/" class="tag-link">Learning</a>
        
        <a href="https://sakthipriyan.com/software-engineering/tags/bigdata/" class="tag-link">Bigdata</a>
        
        <a href="https://sakthipriyan.com/software-engineering/tags/code/" class="tag-link">Code</a>
    </div><div class="content-comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'sakthipriyan';
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div>
</footer>
</article>

    </main><footer class="site-footer">
    <p>&copy; 2025 Sakthi Priyan H. Built with Hugo and Continuum theme.</p>
</footer><script>
            function runHighlightJS() {
                if (window.hljs) { hljs.highlightAll(); }
            }
        </script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js" onload="runHighlightJS()"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');
            
            console.log('Hamburger menu initialized', { hamburger, navLinks });
            
            if (hamburger && navLinks) {
                
                const overlay = document.createElement('div');
                overlay.className = 'nav-overlay';
                document.body.appendChild(overlay);
                
                console.log('Overlay created and added to body');
                
                
                hamburger.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    hamburger.classList.toggle('active');
                    navLinks.classList.toggle('active');
                    overlay.classList.toggle('active');
                    
                    
                    const isExpanded = hamburger.classList.contains('active');
                    hamburger.setAttribute('aria-expanded', isExpanded);
                    
                    
                    document.body.style.overflow = isExpanded ? 'hidden' : '';
                    
                    console.log('Menu toggled', { isExpanded });
                });
                
                
                overlay.addEventListener('click', function() {
                    console.log('Overlay clicked - closing menu');
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                    overlay.classList.remove('active');
                    hamburger.setAttribute('aria-expanded', 'false');
                    document.body.style.overflow = '';
                });
                
                
                const navLinksElements = navLinks.querySelectorAll('a');
                console.log('Found nav links:', navLinksElements.length);
                
                navLinksElements.forEach(link => {
                    link.addEventListener('click', function(e) {
                        console.log('Link clicked:', link.href);
                        
                        
                        hamburger.classList.remove('active');
                        navLinks.classList.remove('active');
                        overlay.classList.remove('active');
                        hamburger.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    });
                });
                
                
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768 && hamburger.classList.contains('active')) {
                        console.log('Window resized - closing menu');
                        hamburger.classList.remove('active');
                        navLinks.classList.remove('active');
                        overlay.classList.remove('active');
                        hamburger.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    }
                });
            } else {
                console.warn('Hamburger menu elements not found');
            }
        });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5NGEJ767SK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-5NGEJ767SK');
    </script>
</body>
</html>
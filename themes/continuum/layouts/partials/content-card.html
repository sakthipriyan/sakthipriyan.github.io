{{/*
Content Card Partial
Usage: {{ partial "content-card.html" . }}
Renders a content card with image, title, summary, meta, and tags
*/}}
<article class="content-card">
    <a href="{{ .RelPermalink }}" class="card-link" {{- if or (in .RelPermalink "/slides/") (in .RelPermalink "/books/") }} target="_blank" {{- end }}>
        <!-- Image if specified -->
        {{ if .Params.image }}
        <div class="card-image">
            <img src="{{ .Params.image | absURL }}" alt="{{ .Title }}" loading="lazy">
        </div>
        {{ else if .Params.youtube_id }}
        <div class="card-image video-image">
            <img src="https://img.youtube.com/vi/{{ .Params.youtube_id }}/maxresdefault.jpg" alt="{{ .Title }}"
                loading="lazy">
            <div class="video-overlay">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                    <path d="M8 5v14l11-7z" />
                </svg>
            </div>
            {{ if .Params.duration }}
            <span class="duration-badge">{{ .Params.duration }}</span>
            {{ end }}
        </div>
        {{ end }}

        <div class="card-content">
            <!-- Icon and Title -->
            <div class="card-header">
                {{ $contentIcon := "ğŸ“„" }}
                {{ if in .RelPermalink "/videos/" }}{{ $contentIcon = "ğŸ¥" }}
                {{ else if in .RelPermalink "/blogs/" }}{{ $contentIcon = "ğŸ“" }}
                {{ else if in .RelPermalink "/tools/" }}{{ $contentIcon = "ğŸ› ï¸" }}
                {{ else if in .RelPermalink "/slides/" }}{{ $contentIcon = "ğŸ¯" }}
                {{ else if in .RelPermalink "/books/" }}{{ $contentIcon = "ğŸ“š" }}
                {{ end }}
                <span class="content-icon">{{ $contentIcon }}</span>
                <h2 class="card-title">{{ .Title }}</h2>
            </div>

            <!-- Summary -->
            {{ if or .Summary .Description .Params.summary }}
            <p class="card-summary">{{ or .Summary .Description .Params.summary }}</p>
            {{ end }}

            <!-- Meta information -->
            <div class="card-meta">
                {{ if .Date }}
                <span class="meta-item">
                    <span class="meta-icon">ğŸ“…</span>
                    <time datetime="{{ .Date.Format " 2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
                </span>
                {{ end }}

                <!-- Video duration -->
                {{ if .Params.duration }}
                <span class="meta-item">
                    <span class="meta-icon">â±ï¸</span>
                    <span class="duration">{{ .Params.duration }}</span>
                </span>
                {{ end }}

                <!-- Platform (for videos) -->
                {{ if .Params.platform }}
                <span class="meta-item">
                    <span class="meta-icon">ğŸ“º</span>
                    <span class="platform">{{ .Params.platform }}</span>
                </span>
                {{ end }}

                <!-- Tool type -->
                {{ if .Params.tool_type }}
                <span class="meta-item">
                    <span class="meta-icon">ğŸ”§</span>
                    <span class="tool-type">{{ .Params.tool_type | title }}</span>
                </span>
                {{ end }}

                <!-- Difficulty -->
                {{ if .Params.difficulty }}
                <span class="meta-item">
                    <span class="meta-icon">ğŸ“Š</span>
                    <span class="difficulty">{{ .Params.difficulty | title }}</span>
                </span>
                {{ end }}

                <!-- Read time (for blogs without duration) -->
                {{ if and .Content (not .Params.duration) }}
                {{ $words := len (split (plainify .Content) " ") }}
                {{ $readTime := math.Ceil (div $words 200.0) }}
                {{ if gt $readTime 0 }}
                <span class="meta-item">
                    <span class="meta-icon">â±ï¸</span>
                    <span class="read-time">{{ $readTime }} min read</span>
                </span>
                {{ end }}
                {{ end }}
            </div>
        </div>
    </a>

    <!-- Tags outside the main link to avoid nested anchors -->
    {{ $currentSection := .Section }}
    {{ $taxonomyName := "" }}
    {{ if eq $currentSection "building-systems" }}
    {{ $taxonomyName = "systems_tags" }}
    {{ else if eq $currentSection "building-wealth" }}
    {{ $taxonomyName = "wealth_tags" }}
    {{ end }}

    {{ if $taxonomyName }}
    {{ $tags := index .Params $taxonomyName }}
    {{ if $tags }}
    <div class="card-tags">
        {{ range $tags }}
        {{ $tagUrl := printf "/%s/tags/%s/" $currentSection (. | urlize) }}
        <a href="{{ $tagUrl | absURL }}" class="tag-link" onclick="event.stopPropagation();">{{ . | title }}</a>
        {{ end }}
    </div>
    {{ end }}
    {{ end }}
</article>
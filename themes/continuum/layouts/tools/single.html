{{ define "main" }}
<article class="tool">
    {{ partial "content-header.html" . }}

    <!-- Custom HTML Tool Interface -->
    {{ if .Params.custom_html }}
    <div class="tool-interface custom-tool">
        {{ $toolDir := printf "tools/%s/%s" .Section .File.BaseFileName }}
        {{ $indexPath := printf "static/%s/index.html" $toolDir }}
        {{ if fileExists $indexPath }}
        {{ $indexPath | readFile | safeHTML }}
        {{ else }}
        <iframe src="{{ printf " /%s/index.html" $toolDir | absURL }}" width="100%" height="600" frameborder="0">
            <p>Your browser does not support iframes. <a href="{{ printf " /%s/index.html" $toolDir | absURL }}">Open
                    tool in new window</a></p>
        </iframe>
        {{ end }}
    </div>
    {{ else if .Params.tool_type }}
    <!-- JavaScript Tool Interface -->
    <div class="tool-interface">
        <div id="tool-{{ .Params.tool_type }}" class="tool-widget">
            <!-- Tool interface will be rendered here by JavaScript -->
        </div>
    </div>
    {{ end }}

    <div class="tool-content">
        {{ .Content }}
    </div>

    {{ if .Params.source_code }}
    <div class="tool-source">
        <h3>Source Code</h3>
        <a href="{{ .Params.source_code }}" target="_blank" rel="noopener">View Source</a>
    </div>
    {{ end }}

    {{ partial "content-footer.html" . }}
</article>
{{ end }}

{{ define "scripts" }}
{{ if .Params.tool_type }}
{{- /* Load Vue.js for tools */ -}}
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
{{- /* Load ECharts if tool needs it */ -}}
{{ if or (eq .Params.tool_type "sipCalculator") (eq .Params.tool_type "emiCalculator") }}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
{{ end }}
{{- /* Load tool-specific JavaScript */ -}}
{{ if eq .Params.tool_type "emergencyFund" }}
<script src="{{ "js/emergency-fund.js" | absURL }}"></script>
{{ else if eq .Params.tool_type "sipCalculator" }}
<script src="{{ "js/realvalue-sip-engine.js" | absURL }}"></script>
{{ else if eq .Params.tool_type "emiCalculator" }}
<script src="{{ "js/realvalue-emi-engine.js" | absURL }}"></script>
{{ else if eq .Params.tool_type "multiAssetAllocator" }}
{{/* Load ECharts for charts */}}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="{{ "js/multi-asset-allocator.js" | absURL }}"></script>
{{ end }}
<script>
    // Initialize tool based on type
    document.addEventListener('DOMContentLoaded', function () {
        const toolType = '{{ .Params.tool_type }}';
        const toolContainer = document.getElementById('tool-' + toolType);

        if (window.initializeTool && typeof window.initializeTool[toolType] === 'function') {
            window.initializeTool[toolType](toolContainer, {{ .Params.tool_config | jsonify }});
        }
    });
</script>
{{ end }}
{{ end }}
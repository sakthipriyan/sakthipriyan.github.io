<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Building a scalable recommendation engine">
    <meta name="author" content="Sakthi Priyan H">
    <title>Building a scalable recommendation engine - Sakthi Priyan H</title>
    <link rel="shortcut icon" type="image/png" href="/img/favicon.png">
    <link rel="stylesheet" media="screen" href="/css/semantic.min.css">
    <link rel="stylesheet" media="screen" href="/css/highlight-github.min.css">
    <link rel="stylesheet" media="screen" href="/css/main.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-27301991-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <!-- Fixed navbar -->
    <div class="ui inverted blue menu">
      <div class="ui container">
        <a href="/" class="header item" style="font-size:20px">
          Sakthi Priyan H
        </a>
        <a href="/calendar.html" class="item"><i class="calendar icon"></i>Blogs</a>
        <a href="/tags.html" class="item"><i class="tags icon"></i>Tags</a>
      </div>
    </div>
    <!-- Begin page content -->
    <div class="ui two column doubling stackable grid container" id="page">
        <div class="twelve wide column ">
        
<main>
  <article>
    <header>
      <div class="ui stackable grid">
        <div class="thirteen wide column">
          <h1 class="ui header">
            Building a scalable recommendation engine
            <div class="sub header">using play framework, couchbase and elasticsearch</div>
          </h1>
        </div>
        <div class="right aligned three wide column">
          <i class="calendar icon"></i>
          <time datetime="2015-05-30">
            May 30, 2015
          </time>
        </div>
      </div>
    </header>
    <div class="ui divider"></div>
    <div class="blog-main">
    <p>Note: <em>This article is more on technology stack selection than how to use different algorithms to generate recommendations.</em></p>
<h3>Intro</h3>
<p>Recommendation engines are everywhere trying to suggest relevant things to users and relevant recommendation increases the business value. Recommendation engine is usually built on top of insights data. Insights are generated as follows.</p>
<ul>
<li>Data is ingested, cleaned, enriched and standardized in required format.</li>
<li>Various algorithms are run on top this data to produce output.</li>
<li>Insights data is created based on the output produced by algorithms.</li>
</ul>
<p><strong>In short</strong>, insights are generated by the algorithms from the standardized data.</p>
<h3>Goals</h3>
<ul>
<li>Recommendation engine, responding within a second for large number of concurrent users.</li>
<li>Horizontally scalable system. Add more nodes to increase capacity.</li>
</ul>
<p><strong>In short</strong>, speed and easy scalability.</p>
<h3>Tech Stack</h3>
<ol>
<li><a href="http://nginx.org/">Nginx</a> serves as end point for APIs. It serves two roles,<ol>
<li>Load balancing : Distributing the load to actual play framework apps.</li>
<li>SSL Termination : It is always a recommended practice to use SSL if any user data is involved and set it up in the reverse proxy.</li>
</ol>
</li>
<li><a href="http://playframework.com">Play framework</a> app works as Rest API server providing recommendations. It is Sessionless and Servlet free. It uses <a href="https://www.playframework.com/documentation/2.4.x/Iteratees">iteratee</a> and <a href="http://netty.io/">netty</a> to easily scale. Also, it has better productivity with <em>Hit refresh workflow</em>. This application acted more like a wrapper around the core module.</li>
<li><a href="http://en.wikipedia.org/wiki/Spring_Framework">Spring framework</a> is primarily used for dependency injection. Alternatively you can use <a href="https://github.com/google/guice">google guice</a> as well. Core application logic is written here. Usually it would be better to have the core logic in a separate module and add that as dependency in the Rest API application. It would be much easier to provide different kind of integration later, if required.</li>
<li><a href="http://www.couchbase.com/nosql-databases/couchbase-server">Couchbase</a> is used as a cache database server, data retrieval is relatively much faster than traditional RDBMS and even alternate document based storage systems. It has GUI to easily add/remove nodes. Now, it supports key and value eviction and so, it is no more RAM limited. Prefer to bulk get the documents.</li>
<li><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> is used as a search server. It has numerous Search APIs. In our use case, most of the recommendations had geo location associated with it. Elastic search is helpful in the location based searches. Also, used in auto completes where user location and input text is taken up. Elasticsearch also horizontally scalable search engine. We can easily add more nodes if required.</li>
</ol>
<h3>Learnings</h3>
<ul>
<li>Most of the heavy duty work is done in batch mode before insights are generated.</li>
<li>Often insights are limited in size due to speed constraints on real time recommendation. It is trade off between speed and relevance.</li>
<li>Choice of Play Framework, Couchbase and Elasticsearch worked well together.</li>
<li>JSONs Everywhere. Both cache server and search server data is stored as Json. As well as recommendations are in JSON.</li>
<li>Except Nginx, all other components used here are horizontally scalable. As Nginx run on evented model and can support more concurrent users.</li>
<li>More data, add more nodes to Couchbase and Elasticsearch clusters.</li>
<li>More concurrent users, add more Play framework nodes.</li>
</ul>
    </div>
    <div class="ui divider"></div>
    <footer>      
      <h3>Share</h3>
      <p class="blog-main">
      Great!! You read till this point, just go ahead and share this post to your followers, collegues and friends. Thanks!
      </p>
      <div class="ui one column grid">
        <div class="center aligned column">
          <i class="share alternate icon"></i>
          <button class="ui small twitter button" id="twitter">
            <i class="twitter icon"></i> Twitter
          </button>
          <button class="ui small linkedin button" id="linkedin">
            <i class="linkedin icon"></i> LinkedIn
          </button>
          <button class="ui small google plus button" id="google">
            <i class="google plus icon"></i> Google+
          </button>  
              <button class="ui small facebook button" id="facebook">
            <i class="facebook icon"></i> Facebook
          </button>
        </div>
      </div>
      <div class="ui divider"></div>
      <nav>
        <h3>Tags</h3>
        <i class="tags icon"></i>
        
        <a href="/tags/playframework.html" class="ui small tag label with topspace">playframework</a>
        
        <a href="/tags/couchbase.html" class="ui small tag label with topspace">couchbase</a>
        
        <a href="/tags/elasticsearch.html" class="ui small tag label with topspace">elasticsearch</a>
        
        <a href="/tags/design.html" class="ui small tag label with topspace">design</a>
        
        <a href="/tags/big_data.html" class="ui small tag label with topspace">big data</a>
        
        <a href="/tags/recommendation.html" class="ui small tag label with topspace">recommendation</a>
          
        <h3>Blogs</h3>
        <div class="ui two column grid">
          <div class="left aligned column">
            
            <a href="/2015/04/24/sbt-run-support-210-not-found.html" class="ui basic blue button">
              <i class="chevron circle left icon"></i> sbt-run-support-210#sbt-run-support-210_2.10;0.1-SNAPSHOT
            </a>
            
          </div>
          <div class="right aligned column">
            
            <a href="/2015/06/03/testing-spring-application-using-junit.html" class="ui basic blue button">
              Testing Spring Application using JUnit <i class="chevron circle right icon"></i>
            </a>
                  
          </div>
        </div>
      </nav>
      <h3>About Author</h3>
      <div class="ui segment blue with bg">
      <div class="ui divided items">
        <div class="item">
          <div class="ui small image">
            <img src="/img/sakthipriyan.jpg">
          </div>
          <div class="content">
            <span class="header">Sakthi Priyan H</span>
            <div class="meta">
              <span>Passionate Programmer</span>
            </div>
            <div class="description">
              <p>
                <ul>
                  <li>I am passionate about building excellent teams, processes and systems.</li>
                  <li>Primarily I use <b>Java</b>, <b>Scala</b> and <b>Python</b> for building various systems and tools.</li>
                  <li>Building <b>API services</b>, <b>Big data processing</b> and <b>Machine Learning systems</b> in <a target="_blank" href="https://www.crayondata.com">Crayon Data</a>.</li>
                  <li>Also, interested in Golang and bulding web apps using Javascript ecosystem.</li>
                  <li>I wrote my first program in BASIC in 1998, Passionate about computers since then.</li>
                </ul> 
              </p>
            </div>
            <div class="extra">
              <a href="https://twitter.com/sakthipriyan">
                <i class="large twitter icon"></i>
              </a>
              <a href="https://github.com/sakthipriyan">
                <i class="large github icon"></i>
              </a>
              <a href="http://in.linkedin.com/in/sakthipriyans">
                <i class="large linkedin icon"></i>
              </a>
            </div>
          </div>
        </div> 
      </div>
      </div>
    </footer>
  </article>
</main>
<div class="ui divider"></div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'sakthipriyan';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

        </div>
        <div class="four wide column">
          <aside>
            <div class="ui fluid blue card">
              <div class="content">
                <span class="header">sakthipriyan.com</span>
                <div class="meta">
                  <span>About Website</span>
                </div>
              </div>
              <div class="content">
                <b>Blog Posts</b> are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
                <br/>
                <b>Code Snippets</b> are licensed under a <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>
              </div>
              <div class="content">
                Created by <a href="https://github.com/sakthipriyan/webgen">webgen</a> from <a href="https://github.com/sakthipriyan/sakthipriyan.com">source</a>.
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>
    <script src="/js/jquery-1.11.2.min.js" type="text/javascript"></script>
    <script src="/js/highlight.min.js" type="text/javascript"></script>
    <script src="/js/main.js" type="text/javascript"></script>
  </body>
</html>